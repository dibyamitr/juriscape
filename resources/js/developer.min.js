var baseurl=document.currentScript.getAttribute('baseurl');

$(document).ready(function(){
    $(document).find('#tablelist').dataTable();
    $('.subject').select2({
        placeholder: 'Select Subject'
    });
});

$(document).on('click','.ajaxsubmit,.ajaxformsubmit',function(){
	var thisval=$(this);
	var oldhtml=thisval.html();
	var form=thisval.closest('form');
    var formData = new FormData(form[0]);
	var actionurl=form.prop('action');
    $.ajax({
        type: 'post',
        url: actionurl,
        data: formData,
        processData: false,
        contentType: false,
        beforeSend : function () {
            thisval.html('<i class="fas fa-spin fa-spinner"></i>&nbsp;Please wait...');
            thisval.attr('disabled',true);
        },
        success: function (response) {        	
            thisval.html(oldhtml);
            thisval.removeAttr('disabled');
            var responsearr=JSON.parse(response);
            toastr.remove();
            if(responsearr.status=="success")
            {
                if(responsearr.url)
                {
                    toastr.success(responsearr.msg+". Redirecting. Please wait...");
                }
                else
                {
                    toastr.success(responsearr.msg);
                }
            }
            else if(responsearr.status=="error")
            {
                toastr.error(responsearr.msg);
            }
            else if(responsearr.status=="warning")
            {
                toastr.warning(responsearr.msg);
            }
            else if(responsearr.status=="info")
            {
                toastr.info(responsearr.msg);
            }
            if(responsearr.url)
            {
                setTimeout(function(){ window.location.href=responsearr.url; }, 3000);
            }
        }
    });
});

$(document).on('keypress','.entersubmit',function (e) {
	if (e.keyCode == 13) {
		e.stopPropagation();
		e.preventDefault();
		$(this).closest('form').find('.ajaxsubmit').click();
		$(this).closest('form').find('.ajaxformsubmit').click();
	}
});